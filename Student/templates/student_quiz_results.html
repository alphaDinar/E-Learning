{% extends "base.html" %}

{% load static %}

{% block styles %}
<link rel="stylesheet" href="{% static 'quiz.css' %}">
<link rel="stylesheet" href="{% static 'use_quiz.css' %}">
<title>Document</title>
{% endblock styles %}


{% block page %}
<section class="page">
  <p class="score_user">{{score.student}}</p>
  <p class="score_box" data-score="{{score.mark}}">
    <span>{{score.mark}}%</span>
  </p>
  <section class="screen">
    <section data-json="{{score.quiz_con}}" data-user_choice="{{score.choice_box}}"
      data-com_choice="{{score.quiz_ans_box}}" class="quiz_box swiper" onsubmit="run(event)">
      <button type="button" class="quiz_box_next material-symbols-outlined">chevron_right</button>
      <button type="button" class="quiz_box_prev material-symbols-outlined">chevron_left</button>
      <div class="swiper-wrapper"></div>
    </section>
  </section>
  <style>
    .score_user{
      box-shadow: rgba(99, 99, 99, 0.2) 0px 2px 8px 0px;
      padding: 5px 15px;
      border-radius: 40px;
      font-size: 1.1rem;
      font-weight: 600;
    }
  </style>

  
  {% if user.is_teacher %}
  <a href="{% url 'assess_quiz_page' score.quiz.slug %}" class="continue_tag">Return</a>
  {% else %}
  <a href="{% url 'student_assessment_page' %}" class="continue_tag">Return</a>
  {% endif %}
    
  <style>
    .continue_tag{
      padding: 5px 10px;
      border: 1px solid darkgray;
      border-radius: 15px;
    }
  </style>

</section>

<style>
  :root {
    /* --var-bg : rgb(197, 197, 197); */
    --var-score_box: transparent;
  }
  .page{
    flex-direction: column;
    padding: 5vh 0;
    gap: 2rem;
    align-items: center;
  }
  .quiz_box .swiper-slide{
    display: flex;
    justify-content: center;
    align-items: center;
  }
  @media all and (max-width:1300px) {
  .page {
    justify-content: flex-start;
    padding: 20px 0;
  }
}
</style>
{% endblock page %}




{% block js %}
<script>
  const quiz_box_wrapper = document.querySelector('.quiz_box .swiper-wrapper')
  const quiz_box = document.querySelector('.quiz_box')
  let user_choice = JSON.parse(quiz_box.dataset.user_choice)
  let com_choice = JSON.parse(quiz_box.dataset.com_choice)

  if (quiz_box.dataset.json != 'None') {
    JSON.parse(quiz_box.dataset.json).forEach((el, i) => {
      const quiz_box_wrapper = document.querySelector('.quiz_box .swiper-wrapper')
      var slide_sheet = document.createElement('div')
      slide_sheet.classList.add('swiper-slide')

      var question_tag = document.createElement('p')
      question_tag.classList.add('question_tag')
      question_tag.innerHTML = `Question ${el.num}`
      slide_sheet.appendChild(question_tag)
      var question_box = document.createElement('div')
      question_box.innerHTML = el.question
      question_box.classList.add('question_box')
      slide_sheet.appendChild(question_box)
      var answer_box = document.createElement('div')
      answer_box.classList.add('answer_box')
      let tag_box = ['A', 'B', 'C', 'D']
      el.ans_set.forEach((ans, ii) => {
        var answer_label = document.createElement('label')
        var answer = document.createElement('div')
        answer.classList.add('answer')
        var answer_small = document.createElement('small')
        answer_small.innerHTML = tag_box[ii]
        answer.appendChild(answer_small)
        var answer_text = document.createElement('span')
        
        if (user_choice[i] === ans) {
          answer.classList.add('change')
          if (user_choice[i] === com_choice[i].cor_ans) {
            answer.style.background = '#1be685'
            answer.style.border = '1px solid #1be685'
          }else{
            answer.style.background = '#ee4747'
            answer.style.border = '1px solid #ee4747'
          }
        }
        answer_text.innerHTML = ans
        answer.appendChild(answer_text)
        var ans_rad = document.createElement('div')
        ans_rad.classList.add('ans_rad')
        ans_rad.classList.add('material-symbols-outlined')
        ans_rad.innerHTML = 'verified'
        answer.appendChild(ans_rad)
        answer_label.appendChild(answer)
        answer_box.appendChild(answer_label)
      })
      slide_sheet.appendChild(answer_box)
      var cor_ans = document.createElement('span')
      cor_ans.classList.add('cor_ans')
      cor_ans.style.color = '#1de182'
      cor_ans.innerHTML = `<i class='material-symbols-outlined'>verified</i>${com_choice[i].cor_ans}`
      slide_sheet.appendChild(cor_ans)
      quiz_box_wrapper.appendChild(slide_sheet)
    })
  }
</script>
<script>
  var quiz_swiper = new Swiper('.quiz_box', {
    loop: false,
    pagination: {
      el: '.swiper-pagination',
    },
    speed: 500,
    navigation: {
      nextEl: '.quiz_box_next',
      prevEl: '.quiz_box_prev',
    },
  });
</script>



<script>
  var rootElement = document.documentElement;

  const score_box = document.querySelector('.score_box')
  var score = score_box.dataset.score
  if (score > 40 && score < 70) {
    rootElement.style.setProperty('--var-score_box', `#f2b75e`);
  } else if (score > 70) {
    rootElement.style.setProperty('--var-score_box', `#1be685`);
  } else {
    rootElement.style.setProperty('--var-score_box', `#ee4747`);
  }
</script>
{% endblock js %}