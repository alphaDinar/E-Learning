{% extends "base.html" %}
{% load static %}

{% block styles %}
<link rel="stylesheet" href="{% static 'dash.css' %}">
<link rel="stylesheet" href="{% static 'sideBar.css' %}">
<link rel="stylesheet" href="{% static 'Schemes/sideBar_plus.css' %}">
<title>Document</title>
{% endblock styles %}


{% block page %}
<section class="page">
  {% include 'sideBar.html' %}

  {% if user.is_teacher %}
  <section class="main">
  {% else %}
  <section class="main toggle">

    <section class="add_form">
      <form >
        SCHEMEMEE
      </form>
    </section>
    <style>
      .add_form{
        position: absolute;
        background: rgba(255, 255, 255, 0.548);
        width: 100%;
        min-height: 100vh;
        z-index: 50;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .add_form form{
        width: 300px;
        height: 400px;
        background: white;
        border-radius: 15px;
      }
    </style>
  {% endif %}


      {% if user.is_teacher %}
      <header>
        <a href="" class="box">
          <p>
            <i class="material-symbols-outlined">history</i>
            <span>Recent</span>
          </p>
          <span>Cold war</span>
          <p>
            <small class="material-symbols-outlined">trending_flat</small>
          </p>
        </a>
        <div class="chart_box">
          <legend>
            <small class="material-symbols-outlined" style="color: #fe6265;">pending</small>
            <small class="material-symbols-outlined" style="color: #00acea;">bolt</small>
            <small class="material-symbols-outlined" style="color: #acedc2;">verified</small>
          </legend>
          <canvas id="myChart"></canvas>
        </div>
        <a href="" class="box">
          <p>
            <i class="material-symbols-outlined">favorite</i>
            <span>Favorite</span>
          </p>
          <span>Diplomacy</span>
          <p>
            <small class="material-symbols-outlined">trending_flat</small>
          </p>
        </a>
      </header>
      {% endif %}


      <section class="con">
        <form>
          <div>
            <i class="material-symbols-outlined">blur_on</i>
            <span>Schemes | {{schemes.count}}</span>
          </div>
          <input type="text" id="item_in">
          <select id="item_select">
            <option value="all">All</option>
            <option value="pending">Pending</option>
            <option value="active">Active</option>
            <option value="completed">Completed</option>
          </select>

          {% if user.is_teacher %}
          <button type="button" class="material-symbols-outlined">north</button>
          {% else %}
          <p style="cursor: pointer;" class="material-symbols-outlined" onclick="showForm()">add</p>
          {% endif %}

        </form>
        <div class="scheme_box">
          {% for scheme in schemes %}
          <div class="scheme_hold" id="item" data-name="{{scheme.topic}}" data-status="{{scheme.status}}">
            <a href="{% url 'use_scheme_page' scheme.slug %}" class="scheme">
              <i class="material-symbols-outlined">inventory_2</i>
              <span>{{scheme.topic}}</span>

              {% if scheme.status == 'pending' %}
              <p style="background: #fe6265;"></p>
              {% elif scheme.status == 'active' %}
              <p style="background: #00acea;"></p>
              {% else %}
              <p style="background: #acedc2;"></p>
              {% endif %}
              <small>43 mins ago</small>
            </a>

            {% if user.is_teacher %}
            <a href="{% url 'edit_scheme_page' scheme.slug %}" class="edit_scheme">
              <i class="material-symbols-outlined">settings</i>
            </a>
            {% endif %}
          </div>
          {% endfor %}


        </div>
      </section>
    </section>
  </section>
  {% endblock page %}



  {% block js %}
  <script>
    const item_in = document.getElementById('item_in')
    const item_select = document.getElementById('item_select')
    const items = document.querySelectorAll('#item')

    item_in.oninput = () => {
      items.forEach(el => {
        var el_name = el.dataset.name.toLowerCase()
        if (!el_name.includes(item_in.value)) {
          el.style.display = 'none'
        } else {
          el.style.display = 'flex'
        }
        runSearchAnime(el)
      })
    }

    item_select.onchange = () => {
      items.forEach(el => {
        var el_status = el.dataset.status.toLowerCase()
        if (item_select.value === 'all') {
          el.style.display = 'flex'
        } else {
          if (el_status != item_select.value.toLowerCase()) {
            el.style.display = 'none'
          } else {
            el.style.display = 'flex'
          }
        }
        runSearchAnime(el)
      })
    }

    // const runSearchAnime = (el) => {
    //   anime({
    //     targets: el,
    //     translateY: [50, 0],
    //     opacity: [0, 1],
    //     duration: 500,
    //     easing: 'spring(1, 80, 10, 0)'
    //   })
    // }

    items.forEach((el, i) => {
      anime({
        targets: el,
        translateX: [-50, 0],
        opacity: [0, 1],
        duration: 300,
        easing: 'spring(1, 80, 10, 0)',
        delay: i * 100
      })
    })

    document.querySelectorAll('.main header .box').forEach((el, i) => {
      anime({
        targets: el,
        translateY: [-50, 0],
        opacity: [0, 1],
        scale: [0.8, 1],
        duration: 500,
        easing: 'spring(1, 80, 10, 0)',
        delay: i * 100
      })
    })

  </script>

  
  {% if user.is_teacher %}
  <script>
    const ctx = document.getElementById('myChart');
    var pendCount = parseInt('{{status.pend_count}}')
    var actCount = parseInt('{{status.act_count}}')
    var compCount = parseInt('{{status.comp_count}}')
    new Chart(ctx, {
      type: 'doughnut',
      data: {
        datasets: [{
          backgroundColor: ['#00acea', '#acedc2', '#fe6265'],
          data: [actCount, compCount, pendCount],
          borderWidth: 1,
        }]
      },
    });
  </script>
  {% endif %}

  {% endblock js %}