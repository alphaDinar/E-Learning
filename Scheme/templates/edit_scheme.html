{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,300,0,0" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.css"/>
  <link rel="stylesheet" href="{% static 'base.css' %}">
  <link rel="stylesheet" href="{% static 'get_scheme.css' %}">
  <link rel="stylesheet" href="{% static 'edit_scheme.css' %}">
  <title>Document</title>
</head>
<body>
  <section class="page">
    <section class="sideBar">
      <button type="button" id="sideBar_tag" class="material-symbols-outlined">linear_scale</button>
      <header>
        <strong>{{scheme.topic}}</strong>
      </header>
      <nav>
        <small>Edit Resource</small>
        <p>
          <span><i class="material-symbols-outlined">image</i> Images <i class="material-symbols-outlined">chevron_right</i></span>
          <span><i class="material-symbols-outlined">videocam</i> Video <i class="material-symbols-outlined">chevron_right</i></span>
          <span><i class="material-symbols-outlined">description</i> Passage <i class="material-symbols-outlined">chevron_right</i></span>
        </p>
      </nav>

      <footer>
        <a href="{% url 'schemes_page' course.slug %}" class="material-symbols-outlined">arrow_back_ios_new</a>
      </footer>
    </section>
    <i class="material-symbols-outlined" id="hide_nav">expand</i>
    <section class="main">
      <nav>
        <i class="material-symbols-outlined" id="toggle_stats">donut_small</i>
        <i class="material-symbols-outlined" id="toggle_stats">slideshow</i>
      </nav>

      <section class="stat_box">
        last_touched 
        ----
        images 
        passages 
        videos
        ----
        add res
        -----
        status -> pending
        ----
        toggle stat button
      </section>

      <section class="add_form_box">
        <form class="add_form" method="post" enctype="multipart/form-data">
          {% csrf_token %}
          <button type="button" class="material-symbols-outlined">close</button>
          <label for="add_res" class="material-symbols-outlined">
            add_a_photo
          </label>
          <!-- <input type="text"> -->
          <input type="text" class="res_type" name="res_type" style="display: none;">
          <input type="text" class="res_name" name="res_name" placeholder="Image name" required>
          <input type="file" accept="image/*" name="res" class="image" id="add_res" required>
          <div class="dis_box">
          </div>
          <button type="submit">ADD</button>
        </form>
      </section>
      <section class="add_passage_form">
        <form class="passage_form" method="post" enctype="multipart/form-data">
          {% csrf_token %}
          <button type="button" class="material-symbols-outlined">close</button>
          <input type="text" name="res_type" value="passage" style="display: none;">
          <input type="text" placeholder="Title" name="passage_title" required>
          <textarea name="passage_body" placeholder="Body" required></textarea>
          <label for="res_thumb">Attatch thumbnail [optional]</label>
          <input type="file" name="res_thumb" id="res_thumb" accept="image/*" style="display: none;">
          <button type="submit">ADD</button>
        </form>
      </section>
      <style>
        .add_passage_form label{
          background: rgb(81, 205, 254);
          color: white;
          padding: 5px 15px;  
        }
      </style>

      <section class="edit_screen swiper">
        <div class="swiper-wrapper">
          <div class="swiper-slide">
            <div class="res_edit_box_nav">
              <span>Images</span>
              <input type="text">
              <button type="button" id="add_res_image">+<i class="material-symbols-outlined">add_a_photo</i> </button>
            </div>
            <div class="res_edit_box">
              {% for image in scheme.get_images %}
              <div class="res" data-name="{{image.name}}">
                <div style="background-image: url({{image.image.url}});"></div>
                <span>{{image.name}}</span>
                <a data-link="{% url 'delete_image' scheme.slug image.id %}" id="del_res" class="material-symbols-outlined">delete</a>
              </div>
              {% endfor %}
            </div>
          </div>
          <style>
            .res_edit_box_nav{
              box-shadow: rgba(99, 99, 99, 0.2) 0px 2px 8px 0px;
            }
          </style>

          <div class="swiper-slide">
            <div class="res_edit_box_nav">   
              <span>Videos</span>
              <input type="text">
              <button type="button" id="add_res_video">+<i class="material-symbols-outlined">videocam</i></button>
            </div>
            <div class="res_edit_box">
              {% for video in scheme.get_videos %}
              <div class="res" data-name="{{video.name}}">
                <video src="{{video.video.url}}"></video>
                <span>{{video.name}}</span>
                <a data-link="{% url 'delete_video' scheme.slug video.id %}" id="del_res" class="material-symbols-outlined">delete</a>
              </div>
              {% endfor %}
            </div>
          </div>
          <div class="swiper-slide">
            <div class="res_edit_box_nav">   
              <span>Passages</span>
              <input type="text">
              <button type="button" id="add_res_document">+<i class="material-symbols-outlined">description</i></button>
            </div>
            <div class="res_edit_box">
              {% for passage in scheme.get_passages %}
              <div class="res" data-name="{{passage.name}}">
                <div style="background-image: url({{passage.thumb.url}});"></div>
                <span>{{passage.title}}</span>
                <p>
                  <a href="" class="material-symbols-outlined">settings</a>
                  <a id="del_res" class="material-symbols-outlined">delete</a>
                </p>
              </div>
              {% endfor %}
            </div>
          </div>

        </div>
        <div class="del_prompt_box">
          <span>Are tou sure you want to delete ?</span>
          <i></i>
          <div>
            <button style="background: rgb(58, 230, 144);">yes</button>
            <button style="background: salmon;">no</button>
          </div>
        </div>
      </section>
      <script>
        const del_res = document.querySelectorAll('[id="del_res"]')
        const del_prompt_box = document.querySelector('.del_prompt_box')
        const del_prompt_box_res = document.querySelector('.del_prompt_box i')
        const del_prompt_box_nav = document.querySelectorAll('.del_prompt_box button')
        console.log(del_prompt_box_nav)

        del_res.forEach(el=>{
          el.onclick =()=>{
            del_prompt_box.classList.add('show')
            del_prompt_box_res.innerHTML = el.parentElement.dataset.name
            del_prompt_box_nav.forEach((button,i)=>{
              button.onclick =()=>{
                if(i === 0){
                  window.location.href = el.dataset.link
                }else{
                  del_prompt_box.classList.remove('show')
                }
              }
            })
          }
        })
      </script>
      <style>
        .edit_screen{
          display: flex;
          justify-content: center;
        }
        .res_box_nav{
          border: 1px solid black;
        }
        .del_prompt_box{
          width: 280px;
          height: 100px;
          background: white;
          display: flex;
          padding: 10px;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          gap: 0.3rem 0rem;
          position: absolute;
          box-shadow: rgba(100, 100, 111, 0.2) 0px 7px 29px 0px;
          border-radius: 0 0 0 10px;
          top: 0;
          right: -300px;
          z-index: 100;
          transition: 0.4s ease;
        }
        .del_prompt_box.show{
          right: 0;
        }
        .del_prompt_box div button{
          padding: 6px 20px;
          color: white;
          cursor: pointer;
        }
        .del_prompt_box i{
          font-weight: 600;
          color: salmon;
        }
      </style>

      
    </section>


    
  </section>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"
  integrity="sha512-z4OUqw38qNLpn1libAN9BsoDx6nbNFio5lA6CuTp9NlK83b89hgyCVq+N5FdBJptINztxn1Z3SaKSKUS5UP60Q=="
  crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.js"></script>

  <script>
    const sideBar = document.querySelector('.sideBar')
    const sideBar_tag = document.getElementById('sideBar_tag')
  
    sideBar_tag.onclick =()=>{
      main.classList.toggle('change')
      sideBar.classList.toggle('change')
    }
  
  
    var screen_swiper = new Swiper('.edit_screen', {
      loop : false,
      speed:1000,
    })
  </script>
  <script>
    const add_res_image = document.getElementById('add_res_image')
    const add_res_video = document.getElementById('add_res_video')
    const add_res_document = document.getElementById('add_res_document')
    const add_form_box = document.querySelector('.add_form_box')
    const close_form_box = document.querySelector('.add_form_box button')
    const close_passage_form = document.querySelector('.add_passage_form button[type="button"]')

    const dis_box = document.querySelector('.dis_box')

    add_res_image.onclick =()=>{
      dis_box.style.backgroundImage = 'none'
      document.querySelector('.add_form_box .res_type').value = 'image'
      add_form_box.classList.add('change')
    }
    add_res_video.onclick =()=>{
      dis_box.style.backgroundImage = 'none'
      document.querySelector('.add_form_box .res_type').value = 'video'
      document.querySelector('.add_form_box label').innerHTML = 'videocam'
      document.querySelector('.add_form_box .res_name').placeholder = 'video name'
      document.querySelector('.add_form_box input[type="file"]').classList.replace('image','video')
      document.querySelector('.add_form_box input[type="file"]').accept = 'video/*'
      add_form_box.classList.add('change')
    }

    const add_passage_form = document.querySelector('.add_passage_form')
    add_res_document.onclick =()=>{
      add_passage_form.classList.add('change')
    }

    close_form_box.onclick =()=>{
      add_form_box.classList.remove('change')
    }
    close_passage_form.onclick =()=>{
      add_passage_form.classList.remove('change')
    }
    
  </script>
  <script>
    const image_in = document.querySelector('.add_form input[type="file"]') 

    image_in.onchange =()=>{
      const [file] = image_in.files
      var src = URL.createObjectURL(file)
      if(image_in.classList.contains('image')){
        dis_box.style.backgroundImage = `url(${src})`
      }else{
        const dis_box_video = document.createElement('video')
        dis_box_video.controls = true
        dis_box_video.src = src
        dis_box.appendChild(dis_box_video)
      }
    }
  </script>    
  <script>
    const hide_nav = document.getElementById('hide_nav')
    const main = document.querySelector('.main')

    hide_nav.onclick =()=>{
      console.log('meee')
      main.classList.toggle('hide')
    }

    const toggle_stats = document.getElementById('toggle_stats')
    const stat_box = document.querySelector('.stat_box')

    toggle_stats.onclick=()=>{
      stat_box.classList.toggle('change')
    } 
  </script>

  <script>
    const res_box = document.querySelector('.res_edit_box')
    const res = document.querySelectorAll('.res')[0]

    // for (var i = 0; i < 45; i++) {
    //   var res_clone = res.cloneNode(true)
    //   res_box.appendChild(res_clone)
    // }

    const screen = document.querySelector('.screen')

  </script>
    <script>
      if(window.history.replaceState){
        window.history.replaceState(null,null,window.location.href)
      }
    </script>
</body>
</html>